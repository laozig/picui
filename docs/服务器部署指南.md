# PicUIå›¾åºŠæœåŠ¡ æœåŠ¡å™¨éƒ¨ç½²æŒ‡å—

## ğŸ–¥ï¸ éƒ¨ç½²æ¦‚è§ˆ

PicUIå›¾åºŠæœåŠ¡æ”¯æŒå¤šç§éƒ¨ç½²æ–¹å¼ï¼ŒåŒ…æ‹¬æœ¬åœ°éƒ¨ç½²ã€Dockerå®¹å™¨éƒ¨ç½²å’Œå„ç§äº‘å¹³å°éƒ¨ç½²ã€‚æœ¬æŒ‡å—å°†è¯¦ç»†ä»‹ç»å„ç§éƒ¨ç½²æ–¹æ³•ã€‚

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.8+
- è¶³å¤Ÿçš„ç£ç›˜ç©ºé—´ç”¨äºå­˜å‚¨å›¾ç‰‡
- æ¨è: 2GBæˆ–æ›´å¤šå†…å­˜

## ğŸ› ï¸ å¿«é€Ÿæœ¬åœ°éƒ¨ç½²

### 1. å…‹éš†ä»“åº“

```bash
git clone https://github.com/laozig/picui.git
cd picui
```

### 2. å®‰è£…ä¾èµ–

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒ
python -m venv .venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
.venv\Scripts\activate
# Linux/macOS
source .venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 3. é…ç½®ç¯å¢ƒå˜é‡

åˆ›å»º`.env`æ–‡ä»¶ï¼ˆæˆ–è®¾ç½®ç³»ç»Ÿç¯å¢ƒå˜é‡ï¼‰ï¼š

```
# åŸºç¡€é…ç½®
PORT=8000
HOST=0.0.0.0
BASE_URL=http://localhost:8000
UPLOAD_DIR=uploads

# æ–‡ä»¶å¤§å°é™åˆ¶(å­—èŠ‚)ï¼Œé»˜è®¤15MB
MAX_FILE_SIZE=15728640

# å›¾ç‰‡æ£€æµ‹é…ç½®
OFFLINE_CHECK_ENABLED=false
SKIN_THRESHOLD=0.5

# å¹¶å‘æ§åˆ¶
MAX_CONCURRENT_UPLOADS=20
RATE_LIMIT=20
RATE_LIMIT_WINDOW=60

# ç£ç›˜æ£€æŸ¥
DISK_CHECK_INTERVAL=3600
DISK_USAGE_THRESHOLD=80.0
```

### 4. åˆå§‹åŒ–æ•°æ®åº“

é¦–æ¬¡è¿è¡Œä¼šè‡ªåŠ¨åˆ›å»ºæ•°æ®åº“å’Œè¡¨ç»“æ„ã€‚

### 5. å¯åŠ¨æœåŠ¡

```bash
# ç›´æ¥å¯åŠ¨
python main.py

# æˆ–ä½¿ç”¨uvicornå¯åŠ¨ï¼ˆç”Ÿäº§ç¯å¢ƒæ¨èï¼‰
uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
```

## ğŸ³ Dockeréƒ¨ç½²

### ä½¿ç”¨é¢„æ„å»ºçš„Dockeré•œåƒ

```bash
docker pull username/picui:latest

docker run -d \
  --name picui \
  -p 8000:8000 \
  -v /path/to/data:/app/uploads \
  -e BASE_URL=http://your-domain.com \
  username/picui:latest
```

### ä½¿ç”¨Dockerfileè‡ªè¡Œæ„å»º

```bash
# æ„å»ºé•œåƒ
docker build -t picui:latest .

# è¿è¡Œå®¹å™¨
docker run -d \
  --name picui \
  -p 8000:8000 \
  -v /path/to/data:/app/uploads \
  -e BASE_URL=http://your-domain.com \
  picui:latest
```

## â˜ï¸ äº‘å¹³å°éƒ¨ç½²

### éƒ¨ç½²åˆ°Render

1. åœ¨Renderä¸Šåˆ›å»ºä¸€ä¸ªæ–°çš„Web Service
2. è¿æ¥åˆ°æ‚¨çš„Gitä»“åº“
3. é€‰æ‹©åˆé€‚çš„è¿è¡Œæ—¶ï¼ˆPythonï¼‰
4. è®¾ç½®å¯åŠ¨å‘½ä»¤ï¼š`uvicorn main:app --host 0.0.0.0 --port $PORT --workers 4`
5. æ·»åŠ ç¯å¢ƒå˜é‡ï¼Œç‰¹åˆ«æ˜¯BASE_URLå’ŒUPLOAD_DIR
6. åˆ›å»ºä¸€ä¸ªRenderç£ç›˜å¹¶æŒ‚è½½åˆ°UPLOAD_DIR
7. ç‚¹å‡»Deployç­‰å¾…éƒ¨ç½²å®Œæˆ

### éƒ¨ç½²åˆ°Railway

1. ä»GitHubå¯¼å…¥é¡¹ç›®
2. é…ç½®ç¯å¢ƒå˜é‡
3. Railwayå°†è‡ªåŠ¨æ£€æµ‹`railway.json`æ–‡ä»¶å¹¶æŒ‰ç…§é…ç½®éƒ¨ç½²
4. ç‚¹å‡»Generate Domainè·å–æœåŠ¡åŸŸå
5. æ›´æ–°BASE_URLç¯å¢ƒå˜é‡ä¸ºæ–°çš„åŸŸå

### éƒ¨ç½²åˆ°Vercel

æ³¨æ„ï¼šç”±äºVercelçš„Serverlessç‰¹æ€§ï¼Œæ²¡æœ‰æŒä¹…åŒ–æ–‡ä»¶ç³»ç»Ÿï¼Œä¸æ¨èç›´æ¥éƒ¨ç½²PicUIã€‚å¯ä»¥è€ƒè™‘ä»¥ä¸‹æ–¹æ¡ˆï¼š

1. ä¿®æ”¹PicUIä½¿ç”¨äº‘å­˜å‚¨è€Œéæœ¬åœ°å­˜å‚¨
2. ä½¿ç”¨Verceléƒ¨ç½²APIï¼Œä½†å›¾ç‰‡å­˜å‚¨ä½¿ç”¨S3ã€Cloudinaryç­‰äº‘å­˜å‚¨æœåŠ¡
3. ä½¿ç”¨Vercelçš„Edge Functionsç‰¹æ€§ï¼Œå°†ä¸Šä¼ è¯·æ±‚ä»£ç†åˆ°å…¶ä»–æ”¯æŒæ–‡ä»¶å­˜å‚¨çš„åç«¯

## ğŸ”§ ç”Ÿäº§ç¯å¢ƒé…ç½®

### ä½¿ç”¨Nginxä½œä¸ºåå‘ä»£ç†

```nginx
server {
    listen 80;
    server_name your-domain.com;

    location / {
        proxy_pass http://localhost:8000;
        proxy_set_header Host $host;
        proxy_set_header X-Real-IP $remote_addr;
        proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
        proxy_set_header X-Forwarded-Proto $scheme;
    }

    # ç›´æ¥æä¾›é™æ€æ–‡ä»¶å’Œä¸Šä¼ çš„å›¾ç‰‡
    location /static/ {
        alias /path/to/picui/static/;
        expires 7d;
    }

    location /uploads/ {
        alias /path/to/picui/uploads/;
        expires 30d;
    }
}
```

### ä½¿ç”¨Supervisorä¿æŒæœåŠ¡è¿è¡Œ

åˆ›å»º`/etc/supervisor/conf.d/picui.conf`ï¼š

```ini
[program:picui]
command=/path/to/venv/bin/uvicorn main:app --host 0.0.0.0 --port 8000 --workers 4
directory=/path/to/picui
user=www-data
autostart=true
autorestart=true
stopasgroup=true
killasgroup=true
stderr_logfile=/var/log/picui/err.log
stdout_logfile=/var/log/picui/out.log
```

é‡è½½Supervisorï¼š

```bash
sudo supervisorctl reread
sudo supervisorctl update
sudo supervisorctl start picui
```

## ğŸ“Š ç›‘æ§ä¸æ—¥å¿—

### é…ç½®Prometheusç›‘æ§

PicUIå†…ç½®äº†PrometheusæŒ‡æ ‡æ¥å£ï¼Œå¯ä»¥é€šè¿‡è®¿é—®`/metrics`è·å–ç›‘æ§æŒ‡æ ‡ã€‚

åœ¨Prometheusé…ç½®ä¸­æ·»åŠ ï¼š

```yaml
scrape_configs:
  - job_name: 'picui'
    scrape_interval: 15s
    static_configs:
      - targets: ['your-domain.com']
```

### æ—¥å¿—é…ç½®

PicUIé»˜è®¤å°†æ—¥å¿—ä¿å­˜åœ¨`upload.log`æ–‡ä»¶ä¸­ã€‚ç”Ÿäº§ç¯å¢ƒå»ºè®®é…ç½®æ—¥å¿—è½®è½¬ï¼š

ä½¿ç”¨logrotateï¼š

```
/path/to/picui/upload.log {
    daily
    missingok
    rotate 14
    compress
    delaycompress
    notifempty
    create 0640 www-data www-data
    sharedscripts
    postrotate
        systemctl reload supervisor
    endscript
}
```

## ğŸ”’ å®‰å…¨å»ºè®®

1. å¯ç”¨HTTPSï¼Œä¿æŠ¤ç”¨æˆ·ä¸Šä¼ çš„å†…å®¹
2. å®šæœŸå¤‡ä»½æ•°æ®åº“å’Œä¸Šä¼ æ–‡ä»¶
3. é™åˆ¶ä¸Šä¼ æ–‡ä»¶å¤§å°ï¼Œé˜²æ­¢æ»¥ç”¨
4. è€ƒè™‘å¯ç”¨å†…å®¹å®‰å…¨å®¡æ ¸
5. å¦‚æœå¼€æ”¾å…¬å…±è®¿é—®ï¼Œå»ºè®®æ·»åŠ éªŒè¯ç æˆ–å…¶ä»–é˜²æ»¥ç”¨æœºåˆ¶

## ğŸš€ æ€§èƒ½ä¼˜åŒ–

1. ä½¿ç”¨å¤šä¸ªå·¥ä½œè¿›ç¨‹ï¼ˆuvicorn --workersï¼‰
2. é…ç½®é€‚å½“çš„å¹¶å‘é™åˆ¶
3. ä½¿ç”¨CDNåˆ†å‘å›¾ç‰‡å†…å®¹
4. è€ƒè™‘å°†å›¾ç‰‡å­˜å‚¨è¿ç§»åˆ°ä¸“ç”¨å¯¹è±¡å­˜å‚¨æœåŠ¡
5. å¯¹æ•°æ®åº“è¿›è¡Œå®šæœŸç»´æŠ¤

## âš ï¸ æ•…éšœæ’é™¤

### æœåŠ¡æ— æ³•å¯åŠ¨

- æ£€æŸ¥ä¾èµ–æ˜¯å¦æ­£ç¡®å®‰è£…
- ç¡®è®¤ç«¯å£æ˜¯å¦è¢«å ç”¨
- æ£€æŸ¥ç¯å¢ƒå˜é‡é…ç½®
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶è·å–è¯¦ç»†é”™è¯¯ä¿¡æ¯

### å›¾ç‰‡ä¸Šä¼ å¤±è´¥

- æ£€æŸ¥ä¸Šä¼ ç›®å½•æƒé™
- ç¡®è®¤ç£ç›˜ç©ºé—´æ˜¯å¦å……è¶³
- æ£€æŸ¥æ–‡ä»¶å¤§å°æ˜¯å¦è¶…è¿‡é™åˆ¶
- æ–‡ä»¶æ ¼å¼æ˜¯å¦å—æ”¯æŒ

### æ•°æ®åº“é”™è¯¯

- å¤‡ä»½å¹¶é‡å»ºæ•°æ®åº“
- æ£€æŸ¥SQLiteæ–‡ä»¶æƒé™
- æ‰§è¡Œæ•°æ®åº“ç»´æŠ¤å‘½ä»¤ 