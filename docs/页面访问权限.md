# PicUI 页面访问与权限控制

本文档详细说明PicUI系统中所有HTML页面的访问路径、权限控制以及会话管理机制。

## HTML页面路径

| 页面名称 | 模板文件 | 访问路径 | 功能说明 |
|---------|---------|---------|---------|
| 主页 | `index.html` | `/` | 提供图片上传、拖拽上传和链接生成功能 |
| 上传日志 | `logs.html` | `/logs/` | 查看图片上传历史记录 |
| 管理面板 | `admin.html` | `/admin` | 图片和系统管理功能的集中入口 |
| 短链接管理 | `short_links.html` | `/admin/short-links` | 管理所有已创建的短链接 |

## 权限控制机制

PicUI采用基于会话Cookie的用户身份识别系统，实现如下权限控制：

### 1. 会话创建

- 用户首次访问任何页面时，系统自动创建一个会话Cookie
- 会话ID使用安全随机令牌生成，保证唯一性
- 同时为用户分配一个唯一的用户ID（UUID格式）

### 2. 数据隔离

所有操作均与用户ID关联，实现数据隔离：

- **上传图片**：图片记录关联用户ID
- **查看日志**：仅显示当前用户的上传记录
- **短链接**：仅显示当前用户创建的短链接
- **图片删除**：仅允许删除自己上传的图片

### 3. 安全考虑

- Cookie设置了HttpOnly属性，防止JavaScript访问
- 使用SameSite=Lax保护，防止CSRF攻击
- 会话有30天有效期，系统定期清理过期会话

## 各页面权限详解

### 主页 (/)

- **模板文件**：`index.html`
- **访问权限**：无限制，所有用户可访问
- **会话行为**：自动创建会话Cookie
- **数据隔离**：上传的图片会关联到当前用户ID

### 上传日志页面 (/logs/)

- **模板文件**：`logs.html`
- **访问权限**：无限制，但内容受限
- **内容限制**：仅显示当前会话用户上传的图片记录
- **提示说明**：页面提示用户"仅显示您账户下的上传日志记录"

### 管理面板 (/admin)

- **模板文件**：`admin.html`
- **访问权限**：无限制，所有用户可访问
- **功能限制**：入口页面，实际操作受用户ID限制
- **会话行为**：保持现有会话或创建新会话

### 短链接管理 (/admin/short-links)

- **模板文件**：`short_links.html`
- **访问权限**：无限制，但内容受限
- **内容限制**：仅显示当前会话用户创建的短链接
- **操作限制**：仅允许删除自己创建的短链接
- **提示说明**：页面提示用户"仅显示您账户下上传的图片相关的短链接"

## 技术实现

PicUI的会话管理和权限控制主要通过以下技术实现：

1. **会话管理模块**：`src/session.py`
   - `get_or_create_session`：获取或创建会话
   - `get_user_id`：从请求中获取用户ID
   - `clean_expired_sessions`：清理过期会话

2. **数据库字段**：
   - 所有相关表（Image、UploadLog、ShortLink）都添加了`user_id`字段
   - 所有查询操作都基于用户ID进行筛选

3. **路由控制**：
   - 在API路由中验证用户身份
   - 在页面路由中自动设置会话Cookie
   - 所有增删改查操作都与用户ID关联

## 更新日志

| 日期 | 变更内容 |
|------|---------|
| 2024-05-18 | 初始版本发布，实现基于Cookie的会话管理和权限控制 |

*最后更新时间：2024-05-18* 