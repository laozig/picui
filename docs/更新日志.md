# PicUI图床服务 - 更新日志

## v1.1.0 (2024-05-15)

### 新功能
- 图片上传现在会自动生成短链接，默认有效期为3天
- 优化了短链接生成和访问流程
- 增强了日志系统，添加了过滤器防止重复警告

### 修复
- 修复了短链接功能无法生成的问题
- 修复了用户ID字段类型不匹配问题
- 修复了图片上传时宽高信息采集错误

### 优化
- 清理了项目代码，移除了未使用的修复脚本和测试文件
- 改进了日志级别设置，默认使用info级别以提供更多调试信息
- 更新了.gitignore文件，更好地忽略临时文件和数据库备份

## v1.0.1 (2024-01-10)

### 改进
- 优化了日志输出系统
- 改进了页面访问速度和响应时间
- 增强了错误处理和异常捕获

### 修复
- 修复了图片宽高采集错误
- 修复了部分浏览器兼容性问题
- 解决了大量上传时的性能瓶颈

## v1.0.0 (2023-12-15)

### 新功能
- 完善了数据库自动升级功能
- 添加了图片水印功能
- 添加了短链接和临时外链功能

### 修复
- 修复了数据库兼容性问题
- 修复了用户ID相关的数据模型
- 改进了文件格式支持

### 其他
- 首次发布稳定版本
- 完善了项目文档
- 添加了Docker部署支持

## 2024年5月更新

### 📝 文档改进

1. **增加中文文档**
   - 添加`使用指南.md` - 详细介绍如何使用PicUI图床
   - 添加`API文档.md` - 完整API接口说明和示例
   - 添加`服务器部署指南.md` - 各种环境下的部署方法
   - 添加`环境变量配置.md` - 所有可配置项说明
   - 添加`更新日志.md` - 记录项目变更历史

2. **更新README.md**
   - 移除用户系统相关介绍
   - 添加文档链接
   - 更新功能描述
   - 更新配置参数
   - 添加多线程与异步部分

### 🚀 性能优化

1. **多线程处理**
   - 添加`ThreadPoolExecutor`处理CPU密集型任务
   - 优化图片处理流程，使用线程池执行
   - 使用线程锁保护全局计数器的并发访问

2. **异步处理改进**
   - 重构`process_image`函数为异步函数
   - 在线程池中执行图片优化和检测
   - 添加水印处理使用异步IO

3. **并发控制**
   - 使用信号量控制并发上传数量
   - 添加`THREAD_POOL_SIZE`环境变量控制线程池大小
   - 使用多进程处理HTTP请求(uvicorn workers)

### 🧹 代码清理与重构

1. **删除冗余文件**
   - 移除`auto_fix.py`, `auto_test.py`
   - 移除`simple.py`, `simple_test.py`
   - 移除`test_upload.py`
   - 移除根目录的`database.py`（已移到src目录）

2. **代码重构**
   - 优化`routes.py`中的请求处理逻辑
   - 使用线程锁保护共享资源
   - 添加定期清理过期数据的任务

### 🔧 配置优化

1. **环境变量更新**
   - 添加`WORKERS`环境变量控制工作进程数
   - 添加`THREAD_POOL_SIZE`环境变量控制线程池大小
   - 使用`python-dotenv`加载`.env`文件

2. **依赖更新**
   - 添加`python-dotenv==1.0.0`
   - 添加`jinja2==3.1.2`
   - 添加`pydantic==2.5.0`
   - 添加`asyncio==3.4.3`
   - 添加`psutil==5.9.6`
   - 添加`concurrent-log-handler==0.9.24`

### 🎯 功能改进

1. **用户界面**
   - 默认使用深色主题
   - 多主题支持（浅色、深色、蓝色、绿色、紫色）
   - 优化移动端显示

2. **安全性改进**
   - 使用线程锁保护全局计数器
   - 定期清理请求记录，防止内存泄漏
   - 异步处理图片内容检测 